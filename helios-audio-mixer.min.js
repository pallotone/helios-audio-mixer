!function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){var n=t[a][1][e];return r(n?n:e)},p,p.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){var o=e("./modules/mix");window.HeliosAudioMixer=o},{"./modules/mix":5}],2:[function(e,t,n){var o=e("./utils"),r={};t.exports=r,r.level=1,r.log=function(e){if(e<=r.level){for(var t="[Mixer] ",n=1;n<arguments.length;n++)t+=arguments[n]+" ";console.log(t)}},r.setLogLvl=function(e){this.debug=o.constrain(e,0,2),r.log(0,"Set log level:",e)}},{"./utils":8}],3:[function(e,t,n){var o={};o.audioTypes=function(){var e=document.createElement("audio");return{".m4a":!(!e.canPlayType||!e.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/,"")),".mp3":!(!e.canPlayType||!e.canPlayType("audio/mpeg;").replace(/no/,"")),".ogg":!(!e.canPlayType||!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))}}(),o.videoTypes=function(){var e=document.createElement("video");return{".webm":!(!e.canPlayType||!e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/no/,"")),".mp4":!(!e.canPlayType||!e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,"")),".ogv":!(!e.canPlayType||!e.canPlayType('video/ogg; codecs="theora"').replace(/no/,""))}}(),o.browser=function(){return window.bowser||!1}(),o.tween=function(){return window.TWEEN||!1}(),o.webAudio=function(){var e=!(!window.AudioContext&&!window.webkitAudioContext),t=!!("Firefox"===o.browser.name&&o.version&&o.version<25),n=!(o.browser.ios!==!0||7!==o.browser.version);return(t||n)&&(e=!1),e}(),o.promise=function(){return"Promise"in window&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise}(),o.supported=function(){return o.browser&&o.tween&&o.webAudio&&o.promise}(),t.exports=o},{}],4:[function(e,t,n){var o=function(){function e(e,t){return r[e]=r[e]||[],r[e].push({id:(new Date).getTime(),cb:t}),this}function t(e,t){var n=this;r[e]=r[e]||[];var o=(new Date).getTime(),i=function(){n.off(e,o),t(n)};return r[e].push({id:o,cb:i}),this}function n(e,t){if("*"===e)r={};else if(e&&"undefined"!=typeof t)for(var n=r[e].length-1;n>=0;n--)r[e][n].id===t&&r[e].splice(n,1);else r[e]=[];return this}function o(e){if(r[e]){var t=this,n=Array.prototype.slice.call(arguments,1);r[e].length&&r[e].forEach(function(e){e.cb.apply(t,n)})}}var r={};return{on:e,one:t,off:n,trigger:o}};t.exports=o},{}],5:[function(e,t,n){var o=e("./utils"),r=e("./events"),i=e("./track"),a=e("./track-html5"),s=e("./detect"),u=e("./debug"),c=function(e){function t(){TWEEN.update(),r.tracks.forEach(function(e){e.updateTimelineEvents()})}function n(){for(var e="",t=0;t<r.tracks.length;t++)e+=r.tracks[t].gain()+"\t"+r.tracks[t].currentTime()+"\t"+r.tracks[t].name+"\n";console.log(e)}var r=this,i={fileTypes:[".mp3",".m4a",".ogg"],html5:!s.webAudio,gain:1};this.options=o.extend(i,e||{}),this.setLogLvl=u.setLogLvl,this.tracks=[],this.lookup={},this.muted=!1,this.context=null,this.detect=s,this.update=t,this.report=n,this.extend=o.extend;for(var a=this.options.fileTypes.length-1;a>=0;a--)s.audioTypes[this.options.fileTypes[a]]||this.options.fileTypes.splice(a,1);return this.options.fileTypes.length<=0?void console.warn("Can’t initialize: none of the specified audio types can play in this browser."):(s.webAudio&&(this.context="function"==typeof AudioContext?new window.AudioContext:new window.webkitAudioContext),void u.log(1,"initialized,",s.webAudio?"Web Audio Mode,":"HTML5 Mode,","can play:",this.options.fileTypes))};c.prototype.on=r.on,c.prototype.one=r.one,c.prototype.off=r.off,c.prototype.trigger=r.trigger,c.prototype.addTrack=function(e){var t,n=this;return!("object"!=typeof e||!e.name)&&(t=e.name,n.lookup[t]?(u.log(0,"a track named “"+t+"” already exists in the mix"),!1):(n.tracks.push(e),n.lookup[t]=e,e))},c.prototype.createTrack=function(e,t){var n=this;if(!e)throw new Error("Can’t create track with no name");if(n.lookup[e])return u.log(0,"a track named “"+n.name+"” already exists"),!1;var o=n.options.html5?new a(e,t,n):new i(e,t,n);return n.tracks.push(o),n.lookup[e]=o,o},c.prototype.removeTrack=function(e){var t,n=this;"string"==typeof e?t=e:"object"==typeof e&&e.name&&(t=e.name);var o=n.lookup[t];if(!o)return void u.log(1,'can’t remove "'+t+'", it doesn’t exist');for(var r=[],i=n.tracks,a=i.length,s=0;s<a;s++)i[s]&&i[s].name===t&&(r=i.slice(s+1||a),i.length=s<0?a+s:s,i.push.apply(i,r));o.destroy(),o.pause(),o.events=[],o.element&&(o.element.src=""),o.trigger("remove",n),o=null,delete n.lookup[t],u.log(2,'Removed track "'+t+'"')},c.prototype.getTrack=function(e){return this.lookup[e]||!1},c.prototype.unlock=function(){var e=this.context.createBuffer(1,1,22050),t=this.context.createBufferSource();t.buffer=e,t.connect(this.context.destination),"function"==typeof t.start?t.start(0):t.noteOn(0),setTimeout(function(){return t.playbackState===t.PLAYING_STATE||t.playbackState===t.FINISHED_STATE},0)},c.prototype.sync=function(e){for(var t=0;t<this.tracks.length;t++)this.tracks[t]!=e&&this.tracks[t].currentTime(e.currentTime())},c.prototype.pause=function(e){u.log(2,"Pausing "+this.tracks.length+" track(s) ||");for(var t=0;t<this.tracks.length;t++)this.tracks[t].pause("number"==typeof e?e:void 0)},c.prototype.play=function(){u.log(2,"Playing "+this.tracks.length+" track(s) >");for(var e=this.context.currentTime+.2,t=0;t<this.tracks.length;t++)console.time("play"+t),this.tracks[t].play(e),console.timeEnd("play"+t)},c.prototype.stop=function(){u.log(2,"Stopping "+this.tracks.length+" track(s) ."),this.tracks.forEach(function(e){e.stop()})},c.prototype.mute=function(){if(!this.muted){this.muted=!0,u.log(2,"Muting "+this.tracks.length+" tracks");for(var e=0;e<this.tracks.length;e++)this.tracks[e].mute()}},c.prototype.unmute=function(){if(this.muted){this.muted=!1,u.log(2,"Unmuting "+this.tracks.length+" tracks");for(var e=0;e<this.tracks.length;e++)this.tracks[e].unmute()}},c.prototype.gain=function(e){if("number"==typeof e){e=o.constrain(e,0,1),this.options.gain=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].gain(this.tracks[t].gain())}return this.options.gain},t.exports=c},{"./debug":2,"./detect":3,"./events":4,"./track":7,"./track-html5":6,"./utils":8}],6:[function(e,t,n){function o(){return this}var r=e("./utils"),i=e("./events"),a=(e("./detect"),e("./debug")),s=function(e,t,n){var o=this,i={source:!1,gain:1,start:0,cachedTime:0,startTime:0,looping:!1,autoplay:!0,muted:!!n.muted};o.options=r.extend(i,t||{}),o.name=e,o.status={loaded:!1,ready:!1,playing:!1},o.mix=n,o.events={},o.tweens={},o.element=void 0,a.log(1,'createTrack "'+o.name+'", mode: "html5", autoplay: '+o.options.autoplay),"string"==typeof o.options.source&&0!==o.options.source.indexOf("blob:")?(o.options.source+=o.mix.options.fileTypes[0],o.element=document.createElement("audio")):"object"==typeof o.options.source&&(o.element=o.options.source,o.source=o.element.src),o.useElement()};s.prototype.on=i.on,s.prototype.one=i.one,s.prototype.off=i.off,s.prototype.trigger=i.trigger,s.prototype.useElement=function(){var e=this;e.options.looping&&(e.element.loop=!0),e.options.muted&&(e.element.muted=!0),e.options.autoplay&&(e.element.autoplay=!0);var t=function(){e.status.loaded=!0,e.options.autoplay&&e.play(),e.trigger("load",e)};e.element.addEventListener("load",t,!1),e.element.addEventListener("canplaythrough",t,!1),e.element.addEventListener("error",function(){e.trigger("loadError")}),e.element.src=e.options.source,e.element.load()},s.prototype.play=function(){var e=this;return a.log(1,'Playing track "'+e.name+'" >'),e.gain(e.options.gain),e.status.ready=!0,e.element.play(),e.trigger("play",e),e},s.prototype.pause=function(e){var t=this;if(t.status.ready&&t.status.playing)return t.element.pause(),a.log(2,'Pausing track "'+t.name+'" at '+t.options.cachedTime),t.trigger("pause",t),t},s.prototype.stop=function(){var e=this;if(e.status.ready&&e.status.playing)return e.element.pause(),e.element.currentTime=0,e.status.playing=!1,e.trigger("stop",e),a.log(2,'Stopping track "'+e.name),e},s.prototype.pan=o,s.prototype.tweenPan=o,s.prototype.gain=function(e){var t=this;return"number"==typeof e?(e=r.constrain(e,0,1),t.element.volume=e*t.mix.options.gain,a.log(2,'"'+t.name+'" setting gain to '+t.options.gain),t.trigger("gain",t.options.gain,t),t):t.element.volume},s.prototype.tweenGain=function(e,t){var n=this;if("number"!=typeof setTo||"number"!=typeof duration)throw new Error("Invalid arguments to tweenGain()");n.tweens.gain&&n.tweens.gain.stop(),n.tweens.gain=new TWEEN.Tween({currentGain:n.options.gain}).to({currentGain:e},t).easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function(){n.gain(this.currentGain)}).start()},s.prototype.mute=function(){return this.options.muted=!0,this},s.prototype.unmute=function(){return this.element.muted=!1,this},s.prototype.currentTime=function(e){if(this.status.ready){var t=this;return"number"==typeof e?(a.log(2,'setting track "'+t.name+'" to time',e),t.element.currentTime=e,t):t.element.currentTime}},s.prototype.formattedTime=function(e){return e?r.timeFormat(this.currentTime())+"/"+r.timeFormat(this.duration()):r.timeFormat(this.currentTime())},s.prototype.duration=function(){return this.element.duration||0},t.exports=s},{"./debug":2,"./detect":3,"./events":4,"./utils":8}],7:[function(e,t,n){var o=e("./utils"),r=e("./detect"),i=e("./debug"),a=e("./events"),s=new Worker("/assets/scripts/pallotone-audio-mixer/download-worker.js"),u=function(e,t,n){function u(){if("buffer"===R.sourceMode)l().then(function(){});else if("element"===R.sourceMode)Q=document.createElement("audio"),c();else{if("mediaStream"!==R.sourceMode)throw new Error('"'+R.sourceMode+'" is an invalid source mode.');T()}}function c(){return i.log(2,'Track "'+e+'" using HTML5 element source: "'+R.source+'"'),R.loop&&(Q.loop=!0),R.muted&&(Q.muted=!0),Q.volume=R.gain,Q.crossOrigin="",V=n.context.createMediaElementSource(Q),Q.addEventListener("canplaythrough",p),Q.addEventListener("error",f),Q.src=R.source,z}function p(){oe.loaded=!0,(R.autoplay||ce)&&g(),le.trigger("load",z)}function l(){return new Promise(function(t,n){i.log(2,'Track "'+e+'" webAudio source: "'+R.source+'"'),s.postMessage(R.source),s.onmessage=function(e){console.log("in onmessage callback",e),d(e)}})}function f(){le.trigger("loadError",z)}function d(t){console.log("in onreadystatechange",t);var o=t.data;4===o.readyState&&(200===o.status||206===o.status||304===o.status?(i.log(2,'"'+e+'" loaded "'+R.source+'"'),K=o.response,n.context.decodeAudioData(K,function(e){$=e,oe.loaded=!0,le.trigger("load",z)})):(i.log(1,'couldn’t load track "'+e+'" with source "'+R.source+'"'),le.trigger("loadError",z,{status:o.status})))}function g(e){return console.time("play"+ue),void 0!==e&&(se=e),oe.loaded?oe.playing?z:(ce=!1,"buffer"===R.sourceMode?y().then(h):"element"===R.sourceMode?m():"mediaStream"===R.sourceMode&&b(),z):(ce=!0,z)}function m(){re.gain||(M(),Q.addEventListener("ended",function(){le.trigger("ended",z)},!1),Q.addEventListener("loop",function(){le.trigger("loop",z)},!1)),oe.ready=!0,le.trigger("ready",z),R.loop&&(Q.loop=!0),D(R.gain),O(R.pan),ie=Q.currentTime-ae;var e=ae||0;Q.currentTime=e,Q.play(),oe.playing=!0,le.trigger("play",z)}function y(){return new Promise(function(e,t){oe.ready=!1,V=null,$&&(V=n.context.createBufferSource(),this.source=V,V.buffer=$,e())})}function h(){if(!oe.playing){M(),oe.ready=!0,ie=V.context.currentTime-ae;var t=ae||0;i.log(2,'Playing track (buffer) "'+e+'" from '+t+" ("+ie+") gain "+D()),"function"==typeof V.start?(V.start(se,t),console.timeEnd("play"+ue)):V.noteOn(t+.1),V.loop=!!R.loop,D(R.gain),O(R.pan),v(),oe.playing=!0,le.trigger("play",z)}}function v(){var e=ae||0,t=V.buffer.duration-e;J&&clearTimeout(J),J=setTimeout(w,1e3*t)}function w(){R.looping?(le.trigger("loop",z),k(0),g()):le.trigger("ended",z)}function T(e){V=n.context.createMediaStreamSource(R.source),oe.loaded=!0,(R.autoplay||e)&&g()}function b(){M(),oe.ready=!0,le.trigger("ready",z),D(R.gain),O(R.pan),oe.playing=!0,le.trigger("play",z)}function k(t){return oe.ready&&oe.playing?(ae="number"==typeof t?t:W(),oe.playing=!1,J&&clearTimeout(J),"buffer"===R.sourceMode?"function"==typeof V.stop?V.stop(0):"function"==typeof V.noteOff&&V.noteOff(0):"element"===R.sourceMode&&Q.pause(),i.log(2,'Pausing track "'+e+'" at '+ae),le.trigger("pause",z),z):(ce=!1,R.autoplay=!1,z)}function E(){return oe.ready&&oe.playing?(J&&clearTimeout(J),ae=0,ie=0,"buffer"===R.sourceMode?"function"==typeof V.stop?V.stop(0):"function"==typeof V.noteOff&&V.noteOff(0):(R.autoplay=!1,Q.pause(),Q.currentTime=0),oe.playing=!1,le.trigger("stop",z),R.gain=R.gainCache,z):z}function M(){var e=["panner","gain"].concat(R.nodes||[]),t=V;e.forEach(function(e){if("string"==typeof e&&Y[e]){var o=Y[e](n.context,t);re[e]=o,t=o}}),t.connect(n.context.destination)}function x(e,t){var n=e.createGain();return t.connect(n),n}function P(e,t){var n;return"stereo"===R.panMode&&"function"==typeof e.createStereoPanner?(n=e.createStereoPanner(),ne="stereo"):(n=e.createPanner(),ne="3d"),t.connect(n),n}function L(e,t){if(!e.createConvolver)return t;var n=e.createConvolver();return t.connect(n),n}function A(e,t){if(!e.createDynamicsCompressor)return t;var n=e.createDynamicsCompressor();return t.connect(n),n}function C(e,t){var n=e.createScriptProcessor(2048,1,1),o=e.createAnalyser();return o.smoothingTimeConstant=.2,o.fftSize=32,n.connect(e.destination),o.connect(n),R.bufferLength=o.frequencyBinCount,z.analysis={raw:new Uint8Array(R.bufferLength),average:0,low:0,mid:0,high:0},t.connect(o),o}function S(){if(re.analyse){var e=Math.round(R.bufferLength/3),t=0,n=0;for(re.analyse.getByteFrequencyData(z.analysis.raw),t=0,n=0;n<R.bufferLength;n++)t+=z.analysis.raw[n];for(z.analysis.average=t/R.bufferLength/256,t=0,n=0;n<e;n++)t+=z.analysis.raw[n];for(z.analysis.low=t/e/256,t=0,n=e;n<2*e;n++)t+=z.analysis.raw[n];for(z.analysis.mid=t/e/256,t=0,n=2*e;n<R.bufferLength;n++)t+=z.analysis.raw[n];return z.analysis.high=t/e/256,le.trigger("analyse",z),z.analysis}}function O(e){if(!r.webAudio||!oe.ready||!re.panner)return z;if("3d"===R.panMode||"360"===R.panMode){if("string"==typeof e&&("front"===e?e=0:"back"===e?e=180:"left"===e?e=270:"right"===e&&(e=90)),"number"==typeof e){R.pan=e%360;var t=.017453292519943295*(-e+90),n=R.panX=Math.cos(t),o=R.panY=Math.sin(t),i=R.panZ=-.5;return re.panner.setPosition(n,o,i),le.trigger("pan",z),z}}else if("stereo"===R.panMode){if("stereo"===ne)re.panner.pan.value=e;else{var a=parseInt(e),s=a+90;s>90&&(s=180-s);var u=Math.sin(a*(Math.PI/180)),c=Math.sin(s*(Math.PI/180));re.panner.setPosition(u,0,c)}return le.trigger("pan",z),z}return R.pan}function F(e){return"number"==typeof e?(R.gainCache=e,z):R.gainCache}function D(e){return"number"==typeof e?(e=o.constrain(e,0,1),R.muted?R.gain=0:R.gain=e,"buffer"===R.sourceMode&&re.gain&&(re.gain.gain.value=R.gain*n.options.gain),"element"===R.sourceMode&&(Q.volume=R.gain*n.options.gain),le.trigger("gain",z),z):R.gain}function G(e,t){if("number"!=typeof e||"number"!=typeof t)throw new Error("Invalid arguments to tweenGain()");e=o.constrain(e,.01,1),ee&&ee.stop(),ee=new TWEEN.Tween({gain:R.gain}).to({gain:e},1e3*t).start(),ee.onUpdate(function(){D(this.gain)})}function I(){return F(R.gain),D(0),R.muted=!0,oe.muted=!0,"element"===R.sourceMode&&(Q.muted=!0),z}function N(){return R.muted=!1,oe.muted=!1,"element"===R.sourceMode&&(Q.muted=!1),D(R.gainCache),z}function W(e){if(!oe.ready)return 0;if("number"==typeof e)return"buffer"===R.sourceMode?oe.playing?(k(e),g()):ae=e:Q.currentTime=e,z;if(!oe.playing)return ae||0;if("buffer"===R.sourceMode){var t=V.context.currentTime-ie||0;return t}return Q.currentTime||0}function q(e){return oe.ready?e?o.timeFormat(W())+"/"+o.timeFormat(U()):o.timeFormat(W()):0}function U(){return oe.ready?"buffer"===R.sourceMode?V.buffer.duration||0:Q.duration||0:0}function j(e){return fe.push({id:(new Date).getTime(),start:e.start,end:e.end,onstart:e.onstart,onend:e.onend,active:!e.start}),z}function B(){if(fe.length&&oe.playing){var e=W();if(!e)return;fe.forEach(function(t){(t.start||0===t.start)&&e>=t.start&&!t.active&&(t.onstart&&t.onstart.call(null,z),t.active=!0),t.end&&e>=t.end&&t.active&&(t.onend&&t.onend.call(null,z),t.active=!1)})}}function H(e){}function _(){te&&te.abort()}var z=this;if(!t.source)throw new Error("Can’t create a track without a source.");var Y={analyse:C,gain:x,panner:P,convolver:L,compressor:A},X=!1;if(t.nodes&&t.nodes.length&&t.nodes.forEach(function(e){"string"!=typeof e||Y[e]||(X='"'+e+'" is an unsupported node type')}),X)throw new Error(X);var Z={sourceMode:"buffer",source:!1,nodes:[],gain:1,gainCache:!1,panMode:"stereo",pan:0,panX:0,panY:0,panZ:0,loop:!1,autoplay:!0,muted:!!n.muted},R=o.extend(Z,t||{});R.gainCache===!1&&(R.gainCache=R.gain);var J,K,Q,V,$,ee,te,ne,oe={loaded:!1,ready:!1,playing:!1,paused:!0},re={},ie=0,ae=0,se=0,ue=Math.floor(1e3*Math.random()),ce=!1,pe={test:!0},le=new a,fe=[];i.log(2,'createTrack "'+e+'", mode: "'+R.sourceMode+'", autoplay: '+R.autoplay),u(),z.name=e,z.status=oe,z.options=R,z.nodes=re,z.analysis=pe,this.source=V,"element"===R.sourceMode&&(z.element=Q),z.on=le.on.bind(z),z.one=le.one.bind(z),z.off=le.off.bind(z),z.trigger=le.trigger.bind(z),z.play=g,z.pause=k,z.stop=E,z.getAnalysis=S,z.pan=O,z.gain=D,z.tweenGain=G,z.currentTime=W,z.formattedTime=q,z.duration=U,z.addEvent=j,z.removeEvent=H,z.updateTimelineEvents=B,z.mute=I,z.unmute=N,z.destroy=_};t.exports=u},{"./debug":2,"./detect":3,"./events":4,"./utils":8}],8:[function(e,t,n){function o(){for(var e={},t=arguments,n=t.length,o=0;o<n;o++)for(var r in t[o])t[o].hasOwnProperty(r)&&(e[r]=t[o][r]);return e}function r(e,t,n){return e<t?t:e>n?n:e}function i(e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),n=Math.floor(e-60*t)<10?"0"+Math.floor(e-60*t):Math.floor(e-60*t);return t+":"+n}t.exports={extend:o,constrain:r,timeFormat:i}},{}]},{},[1]);